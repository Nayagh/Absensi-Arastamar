<!DOCTYPE html>

<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Absensi Dosen - STT Arastamar Wamena</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

```
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
    }

    .container {
        max-width: 1400px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        overflow: hidden;
    }

    .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        display: flex;
        align-items: center;
        gap: 30px;
    }

    .header-logo {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        background: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 40px;
        cursor: pointer;
        transition: transform 0.3s;
        overflow: hidden;
    }

    .header-logo:hover {
        transform: scale(1.05);
    }

    .header-logo img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .header-info {
        flex: 1;
    }

    .header-info h1 {
        font-size: 2em;
        margin-bottom: 5px;
    }

    .header-info p {
        opacity: 0.95;
        margin: 3px 0;
    }

    .profile-photo {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        border: 4px solid white;
        background: #f0f0f0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 40px;
        cursor: pointer;
        overflow: hidden;
        transition: transform 0.3s;
    }

    .profile-photo:hover {
        transform: scale(1.05);
    }

    .profile-photo img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .nav-buttons {
        display: flex;
        gap: 10px;
        padding: 15px 20px;
        background: #f9fafb;
        border-bottom: 2px solid #e5e7eb;
        flex-wrap: wrap;
        justify-content: center;
    }

    .nav-btn {
        padding: 12px 20px;
        border: none;
        border-radius: 10px;
        font-size: 0.95em;
        cursor: pointer;
        background: white;
        color: #667eea;
        font-weight: 600;
        transition: all 0.3s;
        border: 2px solid transparent;
        flex: 1;
        min-width: 120px;
        max-width: 200px;
        text-align: center;
    }

    @media (max-width: 768px) {
        .nav-btn {
            font-size: 0.9em;
            padding: 10px 15px;
            min-width: 100px;
        }
        
        .header {
            flex-direction: column;
            text-align: center;
        }
        
        .header-logo, .profile-photo {
            width: 80px;
            height: 80px;
        }
        
        .matkul-grid {
            grid-template-columns: 1fr;
        }
    }

    .nav-btn:hover {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        transform: translateY(-2px);
    }

    .nav-btn.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }

    .main-content {
        padding: 20px;
        min-height: 500px;
    }

    @media (max-width: 768px) {
        .main-content {
            padding: 15px;
        }
    }

    .page-content {
        display: none;
    }

    .page-content.active {
        display: block;
        animation: fadeIn 0.3s;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideIn {
        from { transform: translateX(100px); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }

    @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100px); opacity: 0; }
    }

    .matkul-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }

    .matkul-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 25px;
        border-radius: 15px;
        color: white;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        position: relative;
    }

    .matkul-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.5);
    }

    .matkul-card h3 {
        font-size: 1.3em;
        margin-bottom: 10px;
    }

    .matkul-card p {
        opacity: 0.9;
        font-size: 0.9em;
        margin: 5px 0;
    }

    .add-matkul-card {
        background: white;
        border: 3px dashed #667eea;
        color: #667eea;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        gap: 10px;
    }

    .add-matkul-card:hover {
        background: #f0f4ff;
        transform: translateY(-5px);
    }

    .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        font-size: 1em;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s;
    }

    .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .btn-success {
        background: #10b981;
        color: white;
    }

    .btn-success:hover {
        background: #059669;
    }

    .btn-danger {
        background: #ef4444;
        color: white;
    }

    .btn-danger:hover {
        background: #dc2626;
    }

    .btn-export {
        background: #3b82f6;
        color: white;
        margin-right: 10px;
    }

    .btn-export:hover {
        background: #2563eb;
    }

    .back-btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 10px 20px;
        background: #6b7280;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1em;
        margin-bottom: 20px;
        transition: background 0.3s;
    }

    .back-btn:hover {
        background: #4b5563;
    }

    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.7);
        z-index: 1000;
        align-items: center;
        justify-content: center;
    }

    .modal.show {
        display: flex;
    }

    .modal-content {
        background: white;
        padding: 30px;
        border-radius: 15px;
        max-width: 600px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .modal-header h3 {
        color: #1f2937;
    }

    .close-modal {
        background: none;
        border: none;
        font-size: 2em;
        cursor: pointer;
        color: #6b7280;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #374151;
    }

    .form-group input, .form-group select, .form-group textarea {
        width: 100%;
        padding: 12px;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        font-size: 1em;
    }

    .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
        outline: none;
        border-color: #667eea;
    }

    .checkbox-group {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
    }

    .checkbox-item {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .checkbox-item input[type="checkbox"] {
        width: auto;
    }

    .session-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 25px;
        border-radius: 15px;
        margin-bottom: 25px;
    }

    .session-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
    }

    .student-list {
        background: white;
        border-radius: 12px;
    }

    .student-item {
        display: flex;
        align-items: center;
        gap: 20px;
        padding: 20px;
        border-bottom: 1px solid #e5e7eb;
        transition: background 0.2s;
    }

    .student-item:hover {
        background: #f9fafb;
    }

    .student-number {
        font-size: 1.2em;
        font-weight: 700;
        color: #667eea;
        min-width: 40px;
    }

    .student-info {
        flex: 1;
    }

    .student-name {
        font-size: 1.1em;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 5px;
    }

    .student-nim {
        color: #6b7280;
        font-size: 0.9em;
    }

    .attendance-buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    .attendance-btn {
        padding: 8px 16px;
        border: 2px solid;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.9em;
        font-weight: 600;
        transition: all 0.2s;
        background: white;
    }

    .attendance-btn.hadir {
        border-color: #10b981;
        color: #10b981;
    }

    .attendance-btn.hadir.active {
        background: #10b981;
        color: white;
    }

    .attendance-btn.sakit {
        border-color: #f59e0b;
        color: #f59e0b;
    }

    .attendance-btn.sakit.active {
        background: #f59e0b;
        color: white;
    }

    .attendance-btn.izin {
        border-color: #3b82f6;
        color: #3b82f6;
    }

    .attendance-btn.izin.active {
        background: #3b82f6;
        color: white;
    }

    .attendance-btn.alpa {
        border-color: #ef4444;
        color: #ef4444;
    }

    .attendance-btn.alpa.active {
        background: #ef4444;
        color: white;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        margin-top: 20px;
    }

    th, td {
        padding: 15px;
        text-align: left;
        border-bottom: 1px solid #e5e7eb;
    }

    th {
        background: #f3f4f6;
        font-weight: 600;
        color: #374151;
    }

    tr:hover {
        background: #f9fafb;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    .stat-value {
        font-size: 2.5em;
        font-weight: 700;
        margin-bottom: 5px;
    }

    .stat-label {
        font-size: 0.95em;
        opacity: 0.9;
    }

    .grade-badge {
        display: inline-block;
        padding: 5px 15px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.9em;
    }

    .grade-a { background: #d1fae5; color: #065f46; }
    .grade-b { background: #dbeafe; color: #1e40af; }
    .grade-c { background: #fef3c7; color: #92400e; }
    .grade-d { background: #fee2e2; color: #991b1b; }

    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #6b7280;
    }

    .info-card {
        background: white;
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 15px;
        border-left: 4px solid #667eea;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .info-card h4 {
        color: #1f2937;
        margin-bottom: 10px;
    }

    .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
    }

    @media print {
        body { 
            background: white; 
            padding: 0; 
        }
        .container { 
            box-shadow: none; 
            border-radius: 0; 
        }
        .header { 
            background: #667eea; 
            -webkit-print-color-adjust: exact; 
            print-color-adjust: exact; 
        }
        .nav-buttons, .back-btn, .btn, .attendance-buttons, .delete-btn { 
            display: none !important; 
        }
        .stat-card { 
            -webkit-print-color-adjust: exact; 
            print-color-adjust: exact; 
        }
        .page-content {
            display: block !important;
        }
        #homePage, #pengaturanPage {
            display: none !important;
        }
    }

    .file-upload {
        border: 2px dashed #e5e7eb;
        padding: 30px;
        text-align: center;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s;
    }

    .file-upload:hover {
        border-color: #667eea;
        background: #f9fafb;
    }

    .file-upload input {
        display: none;
    }

    .score-input {
        width: 80px;
        padding: 8px;
        border: 2px solid #e5e7eb;
        border-radius: 6px;
        text-align: center;
        font-size: 1em;
    }

    .score-input:focus {
        outline: none;
        border-color: #667eea;
    }

    .delete-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        background: rgba(255,255,255,0.2);
        border: none;
        color: white;
        padding: 5px 10px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 0.9em;
    }

    .delete-btn:hover {
        background: rgba(255,255,255,0.4);
    }

    .matkul-tab {
        display: none;
    }

    .matkul-tab.active {
        display: block;
    }

    .prodi-selector {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
        margin-top: 20px;
    }

    @media (max-width: 480px) {
        .prodi-selector {
            grid-template-columns: 1fr;
            gap: 12px;
        }
    }

    .prodi-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        border-radius: 12px;
        cursor: pointer;
        text-align: center;
        transition: all 0.3s;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    @media (max-width: 480px) {
        .prodi-card {
            padding: 25px 20px;
        }
    }

    .prodi-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.5);
    }

    .prodi-card:active {
        transform: translateY(-2px);
    }

    .prodi-card h3 {
        font-size: 1.3em;
        margin-top: 10px;
    }

    @media (max-width: 480px) {
        .prodi-card h3 {
            font-size: 1.1em;
        }
    }

    .prodi-card .icon {
        font-size: 3em;
        margin-bottom: 10px;
    }

    @media (max-width: 480px) {
        .prodi-card .icon {
            font-size: 2.5em;
        }
    }

    .attendance-summary {
        background: #f9fafb;
        padding: 15px;
        border-radius: 8px;
        margin-top: 10px;
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 10px;
        text-align: center;
    }

    .attendance-summary-item {
        padding: 10px;
        border-radius: 6px;
        background: white;
    }

    .attendance-summary-item .count {
        font-size: 1.5em;
        font-weight: 700;
        margin-bottom: 5px;
    }

    .attendance-summary-item .label {
        font-size: 0.85em;
        color: #6b7280;
    }

    .attendance-summary-item.hadir .count { color: #10b981; }
    .attendance-summary-item.sakit .count { color: #f59e0b; }
    .attendance-summary-item.izin .count { color: #3b82f6; }
    .attendance-summary-item.alpa .count { color: #ef4444; }
</style>
```

</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-logo" onclick="openLogoModal()">
                <span id="logoDisplay">üéì</span>
            </div>
            <div class="header-info">
                <h1>Sistem Absensi Dosen</h1>
                <p><strong>Dosen:</strong> <span id="dosenName">Nama Dosen</span></p>
                <p><strong>Kampus:</strong> STT Arastamar Wamena</p>
                <p><strong>Lokasi:</strong> Kabupaten Jayawijaya, Provinsi Papua Pegunungan</p>
            </div>
            <div class="profile-photo" onclick="openPhotoModal()">
                <span id="photoDisplay">üë§</span>
            </div>
        </div>

```
    <!-- Navigation -->
    <div class="nav-buttons">
        <button class="nav-btn active" onclick="showPage('home')">üè† Mata Kuliah</button>
        <button class="nav-btn" onclick="showPage('mahasiswa')">üë®‚Äçüéì Data Mahasiswa</button>
        <button class="nav-btn" onclick="showPage('pimpinan')">üëî Data Pimpinan</button>
        <button class="nav-btn" onclick="showPage('pengaturan')">‚öôÔ∏è Pengaturan</button>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Home Page - Daftar Mata Kuliah -->
        <div id="homePage" class="page-content active">
            <h2 style="color: #1f2937; margin-bottom: 20px;">üìö Mata Kuliah Anda</h2>
            <p style="color: #6b7280; margin-bottom: 20px;">Klik kartu mata kuliah untuk mulai absensi, atau tambah mata kuliah baru.</p>
            <div class="matkul-grid" id="matkulGrid">
                <div class="matkul-card add-matkul-card" onclick="openAddMatkulModal()">
                    <div style="font-size: 3em;">‚ûï</div>
                    <div style="font-size: 1.1em; font-weight: 600;">Tambah Mata Kuliah</div>
                    <p style="font-size: 0.85em; margin-top: 5px;">Klik untuk menambah</p>
                </div>
            </div>
        </div>

        <!-- Mahasiswa Page -->
        <div id="mahasiswaPage" class="page-content">
            <h2 style="color: #1f2937; margin-bottom: 10px;">üë®‚Äçüéì Data Mahasiswa</h2>
            <p style="color: #6b7280; margin-bottom: 20px;">Pilih program studi untuk mengelola data mahasiswa</p>
            
            <div class="prodi-selector" id="prodiSelector">
                <div class="prodi-card" onclick="showProdiMahasiswa('teologi')">
                    <div class="icon">üìñ</div>
                    <h3>Teologi</h3>
                    <p id="countTeologi">0 mahasiswa</p>
                </div>
                <div class="prodi-card" onclick="showProdiMahasiswa('pkaud')">
                    <div class="icon">üë∂</div>
                    <h3>PK-AUD</h3>
                    <p id="countPKAUD">0 mahasiswa</p>
                </div>
                <div class="prodi-card" onclick="showProdiMahasiswa('sosiologi')">
                    <div class="icon">ü§ù</div>
                    <h3>Sosiologi Agama</h3>
                    <p id="countSosiologi">0 mahasiswa</p>
                </div>
                <div class="prodi-card" onclick="showProdiMahasiswa('pak')">
                    <div class="icon">‚úùÔ∏è</div>
                    <h3>PAK</h3>
                    <p id="countPAK">0 mahasiswa</p>
                </div>
            </div>
        </div>

        <!-- Prodi Mahasiswa Detail -->
        <div id="prodiMahasiswaPage" class="page-content">
            <button class="back-btn" onclick="showPage('mahasiswa')">‚Üê Kembali</button>
            
            <div class="session-header">
                <div class="session-info">
                    <div>
                        <h2 id="prodiTitle">Program Studi</h2>
                        <p id="prodiInfo">Data Mahasiswa</p>
                    </div>
                    <button class="btn btn-success" onclick="openAddStudentToProdiModal()">‚ûï Tambah Mahasiswa</button>
                </div>
            </div>

            <div id="prodiMahasiswaList"></div>
        </div>

        <!-- Matkul Detail Page -->
        <div id="matkulDetailPage" class="page-content">
            <button class="back-btn" onclick="showPage('home')">‚Üê Kembali</button>
            
            <div class="session-header">
                <div class="session-info">
                    <div>
                        <h2 id="matkulTitle">Mata Kuliah</h2>
                        <p id="matkulInfo">Info Mata Kuliah</p>
                    </div>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="date" id="sessionDate" style="padding: 10px; border-radius: 8px; border: 2px solid white;" onchange="updateSessionDate()">
                        <button class="btn btn-primary" onclick="saveAttendance()">üíæ Simpan</button>
                    </div>
                </div>
            </div>

            <div class="nav-buttons" style="background: white; border: none; padding: 10px 0;">
                <button class="nav-btn active" onclick="showMatkulTab('absensi')">üìù Absensi</button>
                <button class="nav-btn" onclick="showMatkulTab('penilaian')">üìä Penilaian</button>
                <button class="nav-btn" onclick="showMatkulTab('laporan')">üìÑ Laporan</button>
            </div>

            <!-- Tab Absensi -->
            <div id="absensiTab" class="matkul-tab active">
                <div class="student-list" id="studentList"></div>
            </div>

            <!-- Tab Penilaian -->
            <div id="penilaianTab" class="matkul-tab">
                <div style="margin-bottom: 20px;">
                    <button class="btn" style="background: #8b5cf6; color: white; margin-right: 10px;" onclick="switchExamTab('uts')">UTS</button>
                    <button class="btn" style="background: #ec4899; color: white;" onclick="switchExamTab('uas')">UAS</button>
                </div>
                <div id="penilaianContent"></div>
            </div>

            <!-- Tab Laporan -->
            <div id="laporanTab" class="matkul-tab">
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-export" onclick="exportToCSV()">üìä Download CSV</button>
                    <button class="btn btn-export" onclick="exportToWord()">üìÑ Download Word</button>
                    <button class="btn" style="background: #3b82f6; color: white;" onclick="printLaporan()">üñ®Ô∏è Print</button>
                </div>
                <div id="laporanContent"></div>
            </div>
        </div>

        <!-- Pimpinan Page -->
        <div id="pimpinanPage" class="page-content">
            <h2 style="color: #1f2937; margin-bottom: 10px;">Data Pimpinan STT Arastamar Wamena</h2>
            <p style="color: #6b7280; margin-bottom: 20px; padding: 10px; background: #fef3c7; border-radius: 8px; border-left: 4px solid #f59e0b;">
                üîí <strong>Info:</strong> Data pimpinan ini bersifat tetap dan tidak dapat diubah. Data ini akan otomatis muncul di semua laporan.
            </p>
            
            <h3 style="color: #1f2937; margin: 20px 0 15px;">Pimpinan Pusat</h3>
            <div class="info-grid">
                <div class="info-card">
                    <h4>üë®‚Äçüíº Ketua STT</h4>
                    <p style="color: #1f2937; font-size: 1.1em; margin-top: 10px; font-weight: 600;">Dr. Sensius Amon Karlau, M.Th., M.Pd.K</p>
                </div>
                <div class="info-card">
                    <h4>üìö Waket 1 - Bidang Akademik</h4>
                    <p style="color: #1f2937; font-size: 1.1em; margin-top: 10px; font-weight: 600;">Dr. Drs. Edie Rantetasak, MM</p>
                </div>
                <div class="info-card">
                    <h4>üí∞ Waket 2 - Bidang Keuangan</h4>
                    <p style="color: #1f2937; font-size: 1.1em; margin-top: 10px; font-weight: 600;">Eter Sugiarsi, M.Pd.K</p>
                </div>
                <div class="info-card">
                    <h4>üéì Waket 3 - Bidang Kemahasiswaan</h4>
                    <p style="color: #1f2937; font-size: 1.1em; margin-top: 10px; font-weight: 600;">Dorince Wakur, S.Sos</p>
                </div>
            </div>

            <h3 style="color: #1f2937; margin: 30px 0 15px;">Ketua Program Studi</h3>
            <div class="info-grid">
                <div class="info-card">
                    <h4>üìñ Ketua Prodi Teologi</h4>
                    <p style="color: #1f2937; font-size: 1.1em; margin-top: 10px; font-weight: 600;">Dr. Gideon Widiono, M.Pd.K</p>
                </div>
                <div class="info-card">
                    <h4>üë∂ Ketua Prodi PK-AUD</h4>
                    <p style="color: #1f2937; font-size: 1.1em; margin-top: 10px; font-weight: 600;">Soni Ramba', M.Pd</p>
                </div>
                <div class="info-card">
                    <h4>ü§ù Ketua Prodi Sosiologi Agama</h4>
                    <p style="color: #1f2937; font-size: 1.1em; margin-top: 10px; font-weight: 600;">Anika Regina Lau, M.Pd</p>
                </div>
                <div class="info-card">
                    <h4>‚úùÔ∏è Ketua Prodi PAK</h4>
                    <p style="color: #1f2937; font-size: 1.1em; margin-top: 10px; font-weight: 600;">Dr. Alfred Melkianus Toh, M.Pd.K</p>
                </div>
            </div>

            <div style="margin-top: 30px; padding: 20px; background: #dbeafe; border-radius: 8px; border-left: 4px solid #3b82f6;">
                <h4 style="color: #1e40af; margin-bottom: 10px;">‚ÑπÔ∏è Informasi Penting</h4>
                <ul style="color: #1e40af; margin-left: 20px; line-height: 1.8;">
                    <li>Data pimpinan ini akan otomatis muncul di semua laporan yang Anda export (CSV/Word/Print)</li>
                    <li>Jika ada perubahan pimpinan, silakan hubungi administrator sistem atau IT Support</li>
                    <li>Data ini sama untuk semua dosen di STT Arastamar Wamena</li>
                </ul>
            </div>
        </div>

        <!-- Pengaturan Page -->
        <div id="pengaturanPage" class="page-content">
            <h2 style="color: #1f2937; margin-bottom: 20px;">Pengaturan</h2>
            
            <div class="form-group">
                <label>Nama Dosen:</label>
                <input type="text" id="settingDosenName" placeholder="Nama lengkap dosen">
            </div>

            <button class="btn btn-primary" onclick="saveSettings()">üíæ Simpan Pengaturan</button>

            <div style="margin-top: 30px; padding: 20px; background: #fef3c7; border-radius: 8px;">
                <h3 style="color: #92400e; margin-bottom: 10px;">‚ö†Ô∏è Reset Data</h3>
                <p style="color: #92400e; margin-bottom: 15px;">Hati-hati! Tindakan ini akan menghapus semua data.</p>
                <button class="btn btn-danger" onclick="resetAllData()">üóëÔ∏è Reset Semua Data</button>
            </div>
        </div>
    </div>
</div>

<!-- Modals -->
<div id="photoModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Upload Foto Profil</h3>
            <button class="close-modal" onclick="closeModal('photoModal')">&times;</button>
        </div>
        <div class="file-upload" onclick="document.getElementById('photoInput').click()">
            <p>üì∑ Klik untuk upload foto</p>
            <input type="file" id="photoInput" accept="image/*" onchange="uploadPhoto()">
        </div>
    </div>
</div>

<div id="logoModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Upload Logo Kampus</h3>
            <button class="close-modal" onclick="closeModal('logoModal')">&times;</button>
        </div>
        <div class="file-upload" onclick="document.getElementById('logoInput').click()">
            <p>üéì Klik untuk upload logo</p>
            <input type="file" id="logoInput" accept="image/*" onchange="uploadLogo()">
        </div>
    </div>
</div>

<div id="addMatkulModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Tambah Mata Kuliah Baru</h3>
            <button class="close-modal" onclick="closeModal('addMatkulModal')">&times;</button>
        </div>
        <div class="form-group">
            <label>Nama Mata Kuliah:</label>
            <input type="text" id="newMatkulName" placeholder="Contoh: Pemanfaatan Teknologi AI">
        </div>
        <div class="form-group">
            <label>Jadwal:</label>
            <input type="text" id="newMatkulSchedule" placeholder="Contoh: Kamis, 08:00 - 10:00 WIT">
        </div>
        <div class="form-group">
            <label>Program Studi yang mengikuti:</label>
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="prodi_teologi" value="teologi">
                    <label for="prodi_teologi">Teologi</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="prodi_pkaud" value="pkaud">
                    <label for="prodi_pkaud">PK-AUD</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="prodi_sosiologi" value="sosiologi">
                    <label for="prodi_sosiologi">Sosiologi Agama</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="prodi_pak" value="pak">
                    <label for="prodi_pak">PAK</label>
                </div>
            </div>
        </div>
        <button class="btn btn-primary" onclick="addMatkul()">‚ûï Tambah Mata Kuliah</button>
    </div>
</div>

<div id="addStudentToProdiModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Tambah Mahasiswa ke <span id="modalProdiName">Prodi</span></h3>
            <button class="close-modal" onclick="closeModal('addStudentToProdiModal')">&times;</button>
        </div>
        <div class="form-group">
            <label>Nama Mahasiswa:</label>
            <input type="text" id="newProdiStudentName" placeholder="Nama lengkap">
        </div>
        <div class="form-group">
            <label>NIM:</label>
            <input type="text" id="newProdiStudentNIM" placeholder="Nomor Induk Mahasiswa">
        </div>
        <button class="btn btn-primary" onclick="addStudentToProdi()">‚ûï Tambah Mahasiswa</button>
    </div>
</div>

<script>
    const STORAGE_KEY = 'stt_arastamar_multi_matkul_v2';
    let currentMatkul = null;
    let currentDate = '';
    let currentExamType = 'uts';
    let currentProdi = '';
    
    let data = {
        mataKuliah: [],
        mahasiswaPerProdi: {
            teologi: [],
            pkaud: [],
            sosiologi: [],
            pak: []
        },
        settings: {}
    };

    const prodiNames = {
        teologi: 'Teologi',
        pkaud: 'Pendidikan Kristen AUD',
        sosiologi: 'Sosiologi Agama',
        pak: 'Pendidikan Agama Kristen'
    };

    const prodiIcons = {
        teologi: 'üìñ',
        pkaud: 'üë∂',
        sosiologi: 'ü§ù',
        pak: '‚úùÔ∏è'
    };

    // Load data
    function loadData() {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) {
            data = JSON.parse(saved);
            // Ensure mahasiswaPerProdi exists
            if (!data.mahasiswaPerProdi) {
                data.mahasiswaPerProdi = {
                    teologi: [],
                    pkaud: [],
                    sosiologi: [],
                    pak: []
                };
            }
        }
        
        const savedPhoto = localStorage.getItem('dosen_photo');
        if (savedPhoto) {
            document.getElementById('photoDisplay').innerHTML = `<img src="${savedPhoto}" alt="Foto">`;
        }
        
        const savedLogo = localStorage.getItem('kampus_logo');
        if (savedLogo) {
            document.getElementById('logoDisplay').innerHTML = `<img src="${savedLogo}" alt="Logo">`;
        }

        if (data.settings.dosenName) {
            document.getElementById('dosenName').textContent = data.settings.dosenName;
            document.getElementById('settingDosenName').value = data.settings.dosenName;
        }

        renderMatkulGrid();
        updateMahasiswaCounts();
    }

    function saveData() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    function updateMahasiswaCounts() {
        document.getElementById('countTeologi').textContent = `${data.mahasiswaPerProdi.teologi.length} mahasiswa`;
        document.getElementById('countPKAUD').textContent = `${data.mahasiswaPerProdi.pkaud.length} mahasiswa`;
        document.getElementById('countSosiologi').textContent = `${data.mahasiswaPerProdi.sosiologi.length} mahasiswa`;
        document.getElementById('countPAK').textContent = `${data.mahasiswaPerProdi.pak.length} mahasiswa`;
    }

    function showPage(pageName) {
        console.log('Showing page:', pageName);
        
        // Hide all pages
        document.querySelectorAll('.page-content').forEach(page => {
            page.style.display = 'none';
            page.classList.remove('active');
        });
        
        // Remove active from all nav buttons
        document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
        
        const pages = {
            'home': { element: 'homePage', btnIndex: 0 },
            'mahasiswa': { element: 'mahasiswaPage', btnIndex: 1 },
            'pimpinan': { element: 'pimpinanPage', btnIndex: 2 },
            'pengaturan': { element: 'pengaturanPage', btnIndex: 3 }
        };

        if (pages[pageName]) {
            const pageEl = document.getElementById(pages[pageName].element);
            if (pageEl) {
                pageEl.style.display = 'block';
                pageEl.classList.add('active');
                document.querySelectorAll('.nav-btn')[pages[pageName].btnIndex].classList.add('active');
                
                if (pageName === 'mahasiswa') {
                    updateMahasiswaCounts();
                    // Make sure prodi selector is visible
                    const prodiSelector = document.getElementById('prodiSelector');
                    if (prodiSelector) {
                        prodiSelector.style.display = 'grid';
                    }
                }
            } else {
                console.error('Page element not found:', pages[pageName].element);
            }
        }
    }

    function showProdiMahasiswa(prodi) {
        console.log('Opening prodi:', prodi);
        currentProdi = prodi;
        
        // Hide mahasiswa page
        const mahasiswaPage = document.getElementById('mahasiswaPage');
        mahasiswaPage.style.display = 'none';
        mahasiswaPage.classList.remove('active');
        
        // Show prodi detail page
        const prodiPage = document.getElementById('prodiMahasiswaPage');
        prodiPage.style.display = 'block';
        prodiPage.classList.add('active');
        
        document.getElementById('prodiTitle').textContent = prodiNames[prodi];
        document.getElementById('prodiInfo').textContent = `${data.mahasiswaPerProdi[prodi].length} mahasiswa terdaftar`;
        
        renderProdiMahasiswaList();
    }

    function renderProdiMahasiswaList() {
        const listEl = document.getElementById('prodiMahasiswaList');
        const students = data.mahasiswaPerProdi[currentProdi];
        
        if (students.length === 0) {
            listEl.innerHTML = '<div class="empty-state"><p>Belum ada mahasiswa. Klik "Tambah Mahasiswa" untuk menambah data.</p></div>';
            return;
        }
        
        listEl.innerHTML = `
            <table>
                <thead>
                    <tr>
                        <th>No</th>
                        <th>NIM</th>
                        <th>Nama</th>
                        <th>UTS</th>
                        <th>UAS</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody>
                    ${students.map((student, index) => {
                        // Get scores from all matkul
                        let utsScore = 0;
                        let uasScore = 0;
                        let scoreCount = 0;
                        
                        data.mataKuliah.forEach(matkul => {
                            if (matkul.prodi.includes(currentProdi) && matkul.scores[student.nim]) {
                                if (matkul.scores[student.nim].uts) {
                                    utsScore += matkul.scores[student.nim].uts;
                                    scoreCount++;
                                }
                                if (matkul.scores[student.nim].uas) {
                                    uasScore += matkul.scores[student.nim].uas;
                                }
                            }
                        });
                        
                        const avgUts = scoreCount > 0 ? (utsScore / scoreCount).toFixed(1) : '-';
                        const avgUas = scoreCount > 0 ? (uasScore / scoreCount).toFixed(1) : '-';
                        
                        return `
                            <tr>
                                <td>${index + 1}</td>
                                <td>${student.nim}</td>
                                <td>${student.name}</td>
                                <td style="text-align: center; font-weight: 600; color: #8b5cf6;">${avgUts}</td>
                                <td style="text-align: center; font-weight: 600; color: #ec4899;">${avgUas}</td>
                                <td>
                                    <button class="btn btn-danger" style="padding: 5px 15px; font-size: 0.9em;" onclick="deleteStudentFromProdi(${index})">üóëÔ∏è Hapus</button>
                                </td>
                            </tr>
                        `;
                    }).join('')}
                </tbody>
            </table>
            <div style="margin-top: 15px; padding: 15px; background: #f3f4f6; border-radius: 8px; font-size: 0.9em; color: #6b7280;">
                <strong>üìä Keterangan Nilai:</strong>
                <ul style="margin: 10px 0 0 20px; line-height: 1.8;">
                    <li>Nilai UTS dan UAS ditampilkan rata-rata dari semua mata kuliah</li>
                    <li>Untuk melihat nilai per mata kuliah, masuk ke menu "Mata Kuliah" ‚Üí Tab "Penilaian"</li>
                    <li>Tanda "-" berarti belum ada nilai yang diinput</li>
                </ul>
            </div>
        `;
    }

    function openAddStudentToProdiModal() {
        document.getElementById('modalProdiName').textContent = prodiNames[currentProdi];
        document.getElementById('addStudentToProdiModal').classList.add('show');
    }

    function addStudentToProdi() {
        const name = document.getElementById('newProdiStudentName').value.trim();
        const nim = document.getElementById('newProdiStudentNIM').value.trim();
        
        if (!name || !nim) {
            alert('Mohon lengkapi semua field!');
            return;
        }
        
        // Check if NIM already exists
        const exists = data.mahasiswaPerProdi[currentProdi].some(s => s.nim === nim);
        if (exists) {
            alert('NIM sudah terdaftar!');
            return;
        }
        
        data.mahasiswaPerProdi[currentProdi].push({ name, nim, prodi: currentProdi });
        
        saveData();
        document.getElementById('newProdiStudentName').value = '';
        document.getElementById('newProdiStudentNIM').value = '';
        closeModal('addStudentToProdiModal');
        
        showProdiMahasiswa(currentProdi);
        updateMahasiswaCounts();
    }

    function deleteStudentFromProdi(index) {
        if (confirm('Yakin ingin menghapus mahasiswa ini?')) {
            data.mahasiswaPerProdi[currentProdi].splice(index, 1);
            saveData();
            showProdiMahasiswa(currentProdi);
            updateMahasiswaCounts();
        }
    }

    function renderMatkulGrid() {
        const grid = document.getElementById('matkulGrid');
        const addCard = grid.querySelector('.add-matkul-card');
        
        grid.innerHTML = '';
        
        data.mataKuliah.forEach((matkul, index) => {
            const prodiList = matkul.prodi.map(p => prodiNames[p]).join(', ');
            
            // Count total students from all prodis in this matkul
            let totalStudents = 0;
            matkul.prodi.forEach(p => {
                totalStudents += data.mahasiswaPerProdi[p].length;
            });
            
            const card = document.createElement('div');
            card.className = 'matkul-card';
            card.innerHTML = `
                <button class="delete-btn" onclick="deleteMatkul(${index}); event.stopPropagation();">üóëÔ∏è</button>
                <h3>${matkul.name}</h3>
                <p>üìÖ ${matkul.schedule}</p>
                <p>üéì ${prodiList}</p>
                <p>üë• ${totalStudents} mahasiswa</p>
            `;
            card.onclick = () => openMatkul(index);
            grid.appendChild(card);
        });

        grid.appendChild(addCard);
    }

    function openAddMatkulModal() {
        document.getElementById('addMatkulModal').classList.add('show');
    }

    function addMatkul() {
        const name = document.getElementById('newMatkulName').value.trim();
        const schedule = document.getElementById('newMatkulSchedule').value.trim();
        const prodi = [];
        
        ['teologi', 'pkaud', 'sosiologi', 'pak'].forEach(p => {
            if (document.getElementById(`prodi_${p}`).checked) {
                prodi.push(p);
            }
        });

        if (!name || !schedule || prodi.length === 0) {
            alert('Mohon lengkapi semua field!');
            return;
        }

        data.mataKuliah.push({
            name,
            schedule,
            prodi,
            attendance: {},
            scores: {}
        });

        saveData();
        closeModal('addMatkulModal');
        
        document.getElementById('newMatkulName').value = '';
        document.getElementById('newMatkulSchedule').value = '';
        ['teologi', 'pkaud', 'sosiologi', 'pak'].forEach(p => {
            document.getElementById(`prodi_${p}`).checked = false;
        });

        renderMatkulGrid();
    }

    function deleteMatkul(index) {
        if (confirm('Yakin ingin menghapus mata kuliah ini? Semua data akan hilang!')) {
            data.mataKuliah.splice(index, 1);
            saveData();
            renderMatkulGrid();
        }
    }

    function openMatkul(index) {
        currentMatkul = index;
        const matkul = data.mataKuliah[index];
        
        document.getElementById('homePage').style.display = 'none';
        document.getElementById('matkulDetailPage').classList.add('active');
        
        document.getElementById('matkulTitle').textContent = matkul.name;
        const prodiList = matkul.prodi.map(p => prodiNames[p]).join(', ');
        document.getElementById('matkulInfo').textContent = `${matkul.schedule} ‚Ä¢ ${prodiList}`;
        
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('sessionDate').value = today;
        currentDate = today;
        
        showMatkulTab('absensi');
    }

    function showMatkulTab(tabName) {
        document.querySelectorAll('.matkul-tab').forEach(tab => tab.classList.remove('active'));
        document.querySelectorAll('#matkulDetailPage .nav-btn').forEach(btn => btn.classList.remove('active'));
        
        const tabs = ['absensi', 'penilaian', 'laporan'];
        const index = tabs.indexOf(tabName);
        
        document.getElementById(`${tabName}Tab`).classList.add('active');
        document.querySelectorAll('#matkulDetailPage .nav-btn')[index].classList.add('active');

        if (tabName === 'absensi') {
            renderStudentList();
        } else if (tabName === 'penilaian') {
            renderPenilaian();
        } else if (tabName === 'laporan') {
            renderLaporan();
        }
    }

    function getAllStudentsForMatkul() {
        const matkul = data.mataKuliah[currentMatkul];
        let allStudents = [];
        
        matkul.prodi.forEach(prodi => {
            const prodiStudents = data.mahasiswaPerProdi[prodi].map(s => ({
                ...s,
                prodi: prodi
            }));
            allStudents = allStudents.concat(prodiStudents);
        });
        
        return allStudents;
    }

    function renderStudentList() {
        const matkul = data.mataKuliah[currentMatkul];
        const listEl = document.getElementById('studentList');
        const students = getAllStudentsForMatkul();
        
        if (students.length === 0) {
            listEl.innerHTML = '<div class="empty-state"><p>Belum ada mahasiswa. Silakan tambah mahasiswa di menu "Data Mahasiswa"</p></div>';
            return;
        }
        
        listEl.innerHTML = students.map((student, index) => {
            const attendance = matkul.attendance[currentDate] || {};
            const status = attendance[student.nim] || '';
            
            // Status badge untuk menampilkan status terkini
            let statusBadge = '';
            if (status) {
                const statusConfig = {
                    'hadir': { color: '#10b981', text: '‚úì HADIR', bg: '#d1fae5' },
                    'sakit': { color: '#f59e0b', text: 'üè• SAKIT', bg: '#fef3c7' },
                    'izin': { color: '#3b82f6', text: '‚ìò IZIN', bg: '#dbeafe' },
                    'alpa': { color: '#ef4444', text: '‚úó ALPA', bg: '#fee2e2' }
                };
                const config = statusConfig[status];
                statusBadge = `<div style="padding: 8px 16px; background: ${config.bg}; color: ${config.color}; border-radius: 8px; font-weight: 700; font-size: 0.9em; text-align: center; margin-bottom: 10px;">${config.text}</div>`;
            }
            
            return `
                <div class="student-item">
                    <div class="student-number">${index + 1}</div>
                    <div class="student-info">
                        <div class="student-name">${student.name}</div>
                        <div class="student-nim">NIM: ${student.nim} ‚Ä¢ ${prodiNames[student.prodi]}</div>
                        ${statusBadge}
                    </div>
                    <div class="attendance-buttons">
                        <button class="attendance-btn hadir ${status === 'hadir' ? 'active' : ''}" 
                                onclick="setAttendance('${student.nim}', 'hadir')">‚úì Hadir</button>
                        <button class="attendance-btn sakit ${status === 'sakit' ? 'active' : ''}" 
                                onclick="setAttendance('${student.nim}', 'sakit')">üè• Sakit</button>
                        <button class="attendance-btn izin ${status === 'izin' ? 'active' : ''}" 
                                onclick="setAttendance('${student.nim}', 'izin')">‚ìò Izin</button>
                        <button class="attendance-btn alpa ${status === 'alpa' ? 'active' : ''}" 
                                onclick="setAttendance('${student.nim}', 'alpa')">‚úó Alpa</button>
                    </div>
                </div>
            `;
        }).join('');
    }

    function setAttendance(nim, status) {
        const matkul = data.mataKuliah[currentMatkul];
        if (!matkul.attendance[currentDate]) {
            matkul.attendance[currentDate] = {};
        }
        matkul.attendance[currentDate][nim] = status;
        
        // Auto-save
        saveData();
        
        // Re-render untuk update tampilan
        renderStudentList();
        
        // Show notification
        showNotification('Status kehadiran tersimpan!');
    }
    
    function showNotification(message) {
        // Create notification element
        const notif = document.createElement('div');
        notif.style.cssText = `
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 9999;
            font-weight: 600;
            animation: slideIn 0.3s ease;
        `;
        notif.textContent = message;
        document.body.appendChild(notif);
        
        // Remove after 2 seconds
        setTimeout(() => {
            notif.style.animation = 'slideOut 0.3s ease';
            setTimeout(() => notif.remove(), 300);
        }, 2000);
    }

    function updateSessionDate() {
        currentDate = document.getElementById('sessionDate').value;
        renderStudentList();
    }

    function saveAttendance() {
        saveData();
        
        // Hitung berapa mahasiswa yang sudah diabsen
        const matkul = data.mataKuliah[currentMatkul];
        const students = getAllStudentsForMatkul();
        const attendance = matkul.attendance[currentDate] || {};
        
        let absenCount = 0;
        students.forEach(student => {
            if (attendance[student.nim]) {
                absenCount++;
            }
        });
        
        showNotification(`‚úì Data tersimpan! ${absenCount} dari ${students.length} mahasiswa sudah diabsen.`);
    }

    function renderPenilaian() {
        const matkul = data.mataKuliah[currentMatkul];
        const contentEl = document.getElementById('penilaianContent');
        const students = getAllStudentsForMatkul();
        
        if (students.length === 0) {
            contentEl.innerHTML = '<div class="empty-state"><p>Belum ada mahasiswa</p></div>';
            return;
        }

        if (!matkul.scores) matkul.scores = {};
        
        contentEl.innerHTML = `
            <table>
                <thead>
                    <tr>
                        <th>No</th>
                        <th>Nama</th>
                        <th>NIM</th>
                        <th>Prodi</th>
                        <th>Nilai ${currentExamType.toUpperCase()}</th>
                    </tr>
                </thead>
                <tbody>
                    ${students.map((student, index) => {
                        const score = matkul.scores[student.nim] || {};
                        return `
                            <tr>
                                <td>${index + 1}</td>
                                <td>${student.name}</td>
                                <td>${student.nim}</td>
                                <td>${prodiNames[student.prodi]}</td>
                                <td>
                                    <input type="number" class="score-input" 
                                           value="${score[currentExamType] || 0}" 
                                           min="0" max="100"
                                           onchange="updateScore('${student.nim}', '${currentExamType}', this.value)">
                                </td>
                            </tr>
                        `;
                    }).join('')}
                </tbody>
            </table>
            <div style="margin-top: 20px;">
                <button class="btn btn-primary" onclick="saveScores()">üíæ Simpan Nilai</button>
            </div>
        `;
    }

    function switchExamTab(examType) {
        currentExamType = examType;
        renderPenilaian();
    }

    function updateScore(nim, examType, value) {
        const matkul = data.mataKuliah[currentMatkul];
        if (!matkul.scores[nim]) matkul.scores[nim] = {};
        matkul.scores[nim][examType] = parseFloat(value) || 0;
    }

    function saveScores() {
        saveData();
        showNotification(`‚úì Nilai ${currentExamType.toUpperCase()} berhasil disimpan!`);
    }

    function calculateGrade(hadirCount, totalSessions, uts, uas) {
        const attendancePercentage = totalSessions > 0 ? (hadirCount / totalSessions) * 30 : 0;
        const utsScore = (uts / 100) * 30;
        const uasScore = (uas / 100) * 40;
        const finalScore = attendancePercentage + utsScore + uasScore;
        
        if (finalScore >= 80) return { grade: 'A', class: 'grade-a', score: finalScore };
        if (finalScore >= 70) return { grade: 'B', class: 'grade-b', score: finalScore };
        if (finalScore >= 60) return { grade: 'C', class: 'grade-c', score: finalScore };
        return { grade: 'D', class: 'grade-d', score: finalScore };
    }

    function renderLaporan() {
        const matkul = data.mataKuliah[currentMatkul];
        const contentEl = document.getElementById('laporanContent');
        const students = getAllStudentsForMatkul();
        
        if (students.length === 0) {
            contentEl.innerHTML = '<div class="empty-state"><p>Belum ada mahasiswa</p></div>';
            return;
        }
        
        const results = students.map(student => {
            let hadirCount = 0, sakitCount = 0, izinCount = 0, alpaCount = 0;
            
            Object.values(matkul.attendance || {}).forEach(dayData => {
                const status = dayData[student.nim];
                if (status === 'hadir') hadirCount++;
                else if (status === 'sakit') sakitCount++;
                else if (status === 'izin') izinCount++;
                else if (status === 'alpa') alpaCount++;
            });
            
            const totalSessions = Object.keys(matkul.attendance || {}).length;
            const scores = matkul.scores[student.nim] || {};
            const uts = scores.uts || 0;
            const uas = scores.uas || 0;
            
            const gradeInfo = calculateGrade(hadirCount, totalSessions, uts, uas);
            
            return {
                ...student,
                hadirCount,
                sakitCount,
                izinCount,
                alpaCount,
                totalSessions,
                attendancePercentage: totalSessions > 0 ? ((hadirCount / totalSessions) * 100).toFixed(1) : 0,
                uts,
                uas,
                ...gradeInfo
            };
        });
        
        contentEl.innerHTML = `
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value">${students.length}</div>
                    <div class="stat-label">Total Mahasiswa</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${results.filter(r => r.grade === 'A').length}</div>
                    <div class="stat-label">Lulus dengan A</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${results.filter(r => r.attendancePercentage >= 75).length}</div>
                    <div class="stat-label">Kehadiran ‚â• 75%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${Object.keys(matkul.attendance || {}).length}</div>
                    <div class="stat-label">Total Pertemuan</div>
                </div>
            </div>

            <h3 style="color: #1f2937; margin: 30px 0 15px;">Laporan Nilai Akhir Semester</h3>
            <table>
                <thead>
                    <tr>
                        <th>No</th>
                        <th>Nama</th>
                        <th>NIM</th>
                        <th>Prodi</th>
                        <th>Hadir</th>
                        <th>Sakit</th>
                        <th>Izin</th>
                        <th>Alpa</th>
                        <th>%</th>
                        <th>UTS</th>
                        <th>UAS</th>
                        <th>Akhir</th>
                        <th>Grade</th>
                    </tr>
                </thead>
                <tbody>
                    ${results.map((student, index) => `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${student.name}</td>
                            <td>${student.nim}</td>
                            <td>${prodiNames[student.prodi]}</td>
                            <td style="color: #10b981; font-weight: 600;">${student.hadirCount}</td>
                            <td style="color: #f59e0b; font-weight: 600;">${student.sakitCount}</td>
                            <td style="color: #3b82f6; font-weight: 600;">${student.izinCount}</td>
                            <td style="color: #ef4444; font-weight: 600;">${student.alpaCount}</td>
                            <td>${student.attendancePercentage}%</td>
                            <td>${student.uts}</td>
                            <td>${student.uas}</td>
                            <td>${student.score.toFixed(1)}</td>
                            <td><span class="grade-badge ${student.class}">${student.grade}</span></td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        `;
    }

    function exportToCSV() {
        const matkul = data.mataKuliah[currentMatkul];
        const students = getAllStudentsForMatkul();
        
        let csv = 'No,Nama,NIM,Prodi,Hadir,Sakit,Izin,Alpa,Total Pertemuan,Kehadiran %,UTS,UAS,Nilai Akhir,Grade\n';
        
        students.forEach((student, index) => {
            let hadirCount = 0, sakitCount = 0, izinCount = 0, alpaCount = 0;
            
            Object.values(matkul.attendance || {}).forEach(dayData => {
                const status = dayData[student.nim];
                if (status === 'hadir') hadirCount++;
                else if (status === 'sakit') sakitCount++;
                else if (status === 'izin') izinCount++;
                else if (status === 'alpa') alpaCount++;
            });
            
            const totalSessions = Object.keys(matkul.attendance || {}).length;
            const scores = matkul.scores[student.nim] || {};
            const gradeInfo = calculateGrade(hadirCount, totalSessions, scores.uts || 0, scores.uas || 0);
            const attendancePercentage = totalSessions > 0 ? ((hadirCount / totalSessions) * 100).toFixed(1) : 0;
            
            csv += `${index + 1},"${student.name}",${student.nim},${prodiNames[student.prodi]},${hadirCount},${sakitCount},${izinCount},${alpaCount},${totalSessions},${attendancePercentage},${scores.uts || 0},${scores.uas || 0},${gradeInfo.score.toFixed(1)},${gradeInfo.grade}\n`;
        });

        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);
        link.setAttribute('href', url);
        link.setAttribute('download', `Laporan_${matkul.name.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.csv`);
        link.click();
    }

    function exportToWord() {
        const matkul = data.mataKuliah[currentMatkul];
        const students = getAllStudentsForMatkul();
        
        // Data pimpinan hardcoded
        const pimpinan = {
            ketua: 'Dr. Sensius Amon Karlau, M.Th., M.Pd.K',
            waket1: 'Dr. Drs. Edie Rantetasak, MM',
            waket2: 'Eter Sugiarsi, M.Pd.K',
            waket3: 'Dorince Wakur, S.Sos',
            kaprodiTeologi: 'Dr. Gideon Widiono, M.Pd.K',
            kaprodiPKAUD: 'Soni Ramba\', M.Pd',
            kaprodiSosiologi: 'Anika Regina Lau, M.Pd',
            kaprodiPAK: 'Dr. Alfred Melkianus Toh, M.Pd.K'
        };
        
        let html = `
            <html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'>
            <head><meta charset='utf-8'><title>Laporan</title></head>
            <body>
                <div style="text-align: center;">
                    <h1>LAPORAN NILAI AKHIR SEMESTER</h1>
                    <h2>STT ARASTAMAR WAMENA</h2>
                    <p>Kabupaten Jayawijaya, Provinsi Papua Pegunungan</p>
                    <hr>
                </div>
                <div style="margin: 20px 0;">
                    <p><strong>Mata Kuliah:</strong> ${matkul.name}</p>
                    <p><strong>Dosen Pengampu:</strong> ${data.settings.dosenName || 'Nama Dosen'}</p>
                    <p><strong>Jadwal:</strong> ${matkul.schedule}</p>
                    <p><strong>Semester/Tahun:</strong> ${new Date().getFullYear()}</p>
                </div>
                <table border="1" cellpadding="5" cellspacing="0" style="width:100%; border-collapse: collapse; margin-top: 20px;">
                    <thead>
                        <tr style="background-color: #667eea; color: white;">
                            <th>No</th>
                            <th>Nama</th>
                            <th>NIM</th>
                            <th>Prodi</th>
                            <th>Hadir</th>
                            <th>Sakit</th>
                            <th>Izin</th>
                            <th>Alpa</th>
                            <th>%</th>
                            <th>UTS</th>
                            <th>UAS</th>
                            <th>Akhir</th>
                            <th>Grade</th>
                        </tr>
                    </thead>
                    <tbody>
        `;

        students.forEach((student, index) => {
            let hadirCount = 0, sakitCount = 0, izinCount = 0, alpaCount = 0;
            
            Object.values(matkul.attendance || {}).forEach(dayData => {
                const status = dayData[student.nim];
                if (status === 'hadir') hadirCount++;
                else if (status === 'sakit') sakitCount++;
                else if (status === 'izin') izinCount++;
                else if (status === 'alpa') alpaCount++;
            });
            
            const totalSessions = Object.keys(matkul.attendance || {}).length;
            const scores = matkul.scores[student.nim] || {};
            const gradeInfo = calculateGrade(hadirCount, totalSessions, scores.uts || 0, scores.uas || 0);
            const attendancePercentage = totalSessions > 0 ? ((hadirCount / totalSessions) * 100).toFixed(1) : 0;
            
            html += `
                <tr>
                    <td>${index + 1}</td>
                    <td>${student.name}</td>
                    <td>${student.nim}</td>
                    <td>${prodiNames[student.prodi]}</td>
                    <td>${hadirCount}</td>
                    <td>${sakitCount}</td>
                    <td>${izinCount}</td>
                    <td>${alpaCount}</td>
                    <td>${attendancePercentage}%</td>
                    <td>${scores.uts || 0}</td>
                    <td>${scores.uas || 0}</td>
                    <td>${gradeInfo.score.toFixed(1)}</td>
                    <td>${gradeInfo.grade}</td>
                </tr>
            `;
        });

        html += `
                    </tbody>
                </table>
                <div style="margin-top: 20px;">
                    <p><strong>Keterangan:</strong></p>
                    <ul>
                        <li>Total Pertemuan: ${Object.keys(matkul.attendance || {}).length} kali</li>
                        <li>Penilaian Akhir = (Kehadiran √ó 30%) + (UTS √ó 30%) + (UAS √ó 40%)</li>
                        <li>Grade A: ‚â•80 | Grade B: 70-79 | Grade C: 60-69 | Grade D: <60</li>
                    </ul>
                </div>
                <div style="margin-top: 40px;">
                    <p><strong>Mengetahui,</strong></p>
                    <table style="width: 100%; border: none; margin-top: 20px;">
                        <tr>
                            <td style="width: 50%; border: none; vertical-align: top;">
                                <p>Ketua STT Arastamar Wamena</p>
                                <br><br><br>
                                <p><strong><u>${pimpinan.ketua}</u></strong></p>
                            </td>
                            <td style="width: 50%; border: none; vertical-align: top; text-align: right;">
                                <p>Dosen Pengampu</p>
                                <br><br><br>
                                <p><strong><u>${data.settings.dosenName || '_______________'}</u></strong></p>
                            </td>
                        </tr>
                    </table>
                </div>
            </body>
            </html>
        `;

        const blob = new Blob(['\ufeff', html], {
            type: 'application/msword'
        });

        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `Laporan_${matkul.name.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.doc`;
        link.click();
    }

    function printLaporan() {
        window.print();
    }

    function saveSettings() {
        const dosenName = document.getElementById('settingDosenName').value;
        data.settings.dosenName = dosenName;
        document.getElementById('dosenName').textContent = dosenName;
        saveData();
        showNotification('‚úì Pengaturan berhasil disimpan!');
    }

    function resetAllData() {
        if (confirm('PERHATIAN! Semua data akan dihapus permanen. Lanjutkan?')) {
            if (confirm('Apakah Anda benar-benar yakin? Data tidak dapat dikembalikan!')) {
                localStorage.clear();
                location.reload();
            }
        }
    }

    function openPhotoModal() {
        document.getElementById('photoModal').classList.add('show');
    }

    function openLogoModal() {
        document.getElementById('logoModal').classList.add('show');
    }

    function closeModal(modalId) {
        document.getElementById(modalId).classList.remove('show');
    }

    function uploadPhoto() {
        const file = document.getElementById('photoInput').files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const dataUrl = e.target.result;
                document.getElementById('photoDisplay').innerHTML = `<img src="${dataUrl}" alt="Foto">`;
                localStorage.setItem('dosen_photo', dataUrl);
                closeModal('photoModal');
            };
            reader.readAsDataURL(file);
        }
    }

    function uploadLogo() {
        const file = document.getElementById('logoInput').files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const dataUrl = e.target.result;
                document.getElementById('logoDisplay').innerHTML = `<img src="${dataUrl}" alt="Logo">`;
                localStorage.setItem('kampus_logo', dataUrl);
                closeModal('logoModal');
            };
            reader.readAsDataURL(file);
        }
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM Content Loaded');
        loadData();
        
        // Add touch event listeners for better mobile support
        const prodiCards = document.querySelectorAll('.prodi-card');
        prodiCards.forEach(card => {
            card.addEventListener('touchstart', function(e) {
                console.log('Card touched');
            }, { passive: true });
        });
    });
    
    // Also call on window load as backup
    window.addEventListener('load', function() {
        console.log('Window Loaded');
        loadData();
    });
</script>
```

</body>
</html>
